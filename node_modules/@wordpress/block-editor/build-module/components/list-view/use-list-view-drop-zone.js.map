{"version":3,"names":["useSelect","useState","useCallback","useThrottle","__experimentalUseDropZone","useDropZone","isRTL","getDistanceToNearestEdge","isPointContainedByRect","useOnBlockDrop","store","blockEditorStore","NESTING_LEVEL_INDENTATION","isUpGesture","point","rect","nestingLevel","rtl","blockIndentPosition","right","left","x","getDesiredRelativeParentLevel","distanceBetweenPointAndBlockIndentPosition","desiredParentLevel","Math","round","abs","getCandidateBlockParents","candidateBlockData","blocksData","candidateBlockParents","currentBlockData","push","find","blockData","clientId","rootClientId","getNextNonDraggedBlock","index","nextBlockData","isDraggedBlock","isNestingGesture","isNestingHorizontalGesture","y","bottom","ALLOWED_DROP_EDGES","getListViewDropTarget","position","candidateEdge","candidateDistance","candidateRect","candidateBlockIndex","i","length","element","getBoundingClientRect","distance","edge","isCursorWithinBlock","undefined","indexOf","previousBlockData","isDraggingBelow","canInsertDraggedBlocksAsChild","innerBlockCount","isExpanded","newBlockIndex","blockIndex","dropPosition","nextBlock","currentLevel","nextLevel","desiredRelativeLevel","targetParentIndex","max","min","canInsertDraggedBlocksAsSibling","offset","useListViewDropZone","dropZoneElement","getBlockRootClientId","getBlockIndex","getBlockCount","getDraggedBlockClientIds","canInsertBlocks","target","setTarget","targetRootClientId","targetBlockIndex","onBlockDrop","draggedBlockClientIds","throttled","event","currentTarget","clientX","clientY","isBlockDrag","blockElements","Array","from","querySelectorAll","map","blockElement","dataset","block","expanded","classList","contains","parseInt","getAttribute","newTarget","ref","onDrop","onDragLeave","cancel","onDragOver","onDragEnd"],"sources":["@wordpress/block-editor/src/components/list-view/use-list-view-drop-zone.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { useState, useCallback } from '@wordpress/element';\nimport {\n\tuseThrottle,\n\t__experimentalUseDropZone as useDropZone,\n} from '@wordpress/compose';\nimport { isRTL } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport {\n\tgetDistanceToNearestEdge,\n\tisPointContainedByRect,\n} from '../../utils/math';\nimport useOnBlockDrop from '../use-on-block-drop';\nimport { store as blockEditorStore } from '../../store';\n\n/** @typedef {import('../../utils/math').WPPoint} WPPoint */\n\n/**\n * The type of a drag event.\n *\n * @typedef {'default'|'file'|'html'} WPDragEventType\n */\n\n/**\n * An object representing data for blocks in the DOM used by drag and drop.\n *\n * @typedef {Object} WPListViewDropZoneBlock\n * @property {string}  clientId                        The client id for the block.\n * @property {string}  rootClientId                    The root client id for the block.\n * @property {number}  blockIndex                      The block's index.\n * @property {Element} element                         The DOM element representing the block.\n * @property {number}  innerBlockCount                 The number of inner blocks the block has.\n * @property {boolean} isDraggedBlock                  Whether the block is currently being dragged.\n * @property {boolean} isExpanded                      Whether the block is expanded in the UI.\n * @property {boolean} canInsertDraggedBlocksAsSibling Whether the dragged block can be a sibling of this block.\n * @property {boolean} canInsertDraggedBlocksAsChild   Whether the dragged block can be a child of this block.\n */\n\n/**\n * An array representing data for blocks in the DOM used by drag and drop.\n *\n * @typedef {WPListViewDropZoneBlock[]} WPListViewDropZoneBlocks\n */\n\n/**\n * An object containing details of a drop target.\n *\n * @typedef {Object} WPListViewDropZoneTarget\n * @property {string}                  blockIndex   The insertion index.\n * @property {string}                  rootClientId The root client id for the block.\n * @property {string|undefined}        clientId     The client id for the block.\n * @property {'top'|'bottom'|'inside'} dropPosition The position relative to the block that the user is dropping to.\n *                                                  'inside' refers to nesting as an inner block.\n */\n\n// When the indentation level, the corresponding left margin in `style.scss`\n// must be updated as well to ensure the drop zone is aligned with the indentation.\nexport const NESTING_LEVEL_INDENTATION = 28;\n\n/**\n * Determines whether the user is positioning the dragged block to be\n * moved up to a parent level.\n *\n * Determined based on nesting level indentation of the current block.\n *\n * @param {WPPoint} point        The point representing the cursor position when dragging.\n * @param {DOMRect} rect         The rectangle.\n * @param {number}  nestingLevel The nesting level of the block.\n * @param {boolean} rtl          Whether the editor is in RTL mode.\n * @return {boolean} Whether the gesture is an upward gesture.\n */\nfunction isUpGesture( point, rect, nestingLevel = 1, rtl = false ) {\n\t// If the block is nested, and the user is dragging to the bottom\n\t// left of the block (or bottom right in RTL languages), then it is an upward gesture.\n\tconst blockIndentPosition = rtl\n\t\t? rect.right - nestingLevel * NESTING_LEVEL_INDENTATION\n\t\t: rect.left + nestingLevel * NESTING_LEVEL_INDENTATION;\n\treturn rtl ? point.x > blockIndentPosition : point.x < blockIndentPosition;\n}\n\n/**\n * Returns how many nesting levels up the user is attempting to drag to.\n *\n * The relative parent level is calculated based on how far\n * the cursor is from the provided nesting level (e.g. of a candidate block\n * that the user is hovering over). The nesting level is considered \"desired\"\n * because it is not guaranteed that the user will be able to drag to the desired level.\n *\n * The returned integer can be used to access an ascending array\n * of parent blocks, where the first item is the block the user\n * is hovering over, and the last item is the root block.\n *\n * @param {WPPoint} point        The point representing the cursor position when dragging.\n * @param {DOMRect} rect         The rectangle.\n * @param {number}  nestingLevel The nesting level of the block.\n * @param {boolean} rtl          Whether the editor is in RTL mode.\n * @return {number} The desired relative parent level.\n */\nfunction getDesiredRelativeParentLevel(\n\tpoint,\n\trect,\n\tnestingLevel = 1,\n\trtl = false\n) {\n\t// In RTL languages, the block indent position is from the right edge of the block.\n\t// In LTR languages, the block indent position is from the left edge of the block.\n\tconst blockIndentPosition = rtl\n\t\t? rect.right - nestingLevel * NESTING_LEVEL_INDENTATION\n\t\t: rect.left + nestingLevel * NESTING_LEVEL_INDENTATION;\n\n\tconst distanceBetweenPointAndBlockIndentPosition = rtl\n\t\t? blockIndentPosition - point.x\n\t\t: point.x - blockIndentPosition;\n\n\tconst desiredParentLevel = Math.round(\n\t\tdistanceBetweenPointAndBlockIndentPosition / NESTING_LEVEL_INDENTATION\n\t);\n\n\treturn Math.abs( desiredParentLevel );\n}\n\n/**\n * Returns an array of the parent blocks of the block the user is dropping to.\n *\n * @param {WPListViewDropZoneBlock}  candidateBlockData The block the user is dropping to.\n * @param {WPListViewDropZoneBlocks} blocksData         Data about the blocks in list view.\n * @return {WPListViewDropZoneBlocks} An array of block parents, including the block the user is dropping to.\n */\nfunction getCandidateBlockParents( candidateBlockData, blocksData ) {\n\tconst candidateBlockParents = [];\n\tlet currentBlockData = candidateBlockData;\n\n\twhile ( currentBlockData ) {\n\t\tcandidateBlockParents.push( { ...currentBlockData } );\n\t\tcurrentBlockData = blocksData.find(\n\t\t\t( blockData ) =>\n\t\t\t\tblockData.clientId === currentBlockData.rootClientId\n\t\t);\n\t}\n\n\treturn candidateBlockParents;\n}\n\n/**\n * Given a list of blocks data and a block index, return the next non-dragged\n * block. This is used to determine the block that the user is dropping to,\n * while ignoring the dragged block.\n *\n * @param {WPListViewDropZoneBlocks} blocksData Data about the blocks in list view.\n * @param {number}                   index      The index to begin searching from.\n * @return {WPListViewDropZoneBlock | undefined} The next non-dragged block.\n */\nfunction getNextNonDraggedBlock( blocksData, index ) {\n\tconst nextBlockData = blocksData[ index + 1 ];\n\tif ( nextBlockData && nextBlockData.isDraggedBlock ) {\n\t\treturn getNextNonDraggedBlock( blocksData, index + 1 );\n\t}\n\n\treturn nextBlockData;\n}\n\n/**\n * Determines whether the user positioning the dragged block to nest as an\n * inner block.\n *\n * Determined based on nesting level indentation of the current block, plus\n * the indentation of the next level of nesting. The vertical position of the\n * cursor must also be within the block.\n *\n * @param {WPPoint} point        The point representing the cursor position when dragging.\n * @param {DOMRect} rect         The rectangle.\n * @param {number}  nestingLevel The nesting level of the block.\n * @param {boolean} rtl          Whether the editor is in RTL mode.\n */\nfunction isNestingGesture( point, rect, nestingLevel = 1, rtl = false ) {\n\tconst blockIndentPosition = rtl\n\t\t? rect.right - nestingLevel * NESTING_LEVEL_INDENTATION\n\t\t: rect.left + nestingLevel * NESTING_LEVEL_INDENTATION;\n\n\tconst isNestingHorizontalGesture = rtl\n\t\t? point.x < blockIndentPosition - NESTING_LEVEL_INDENTATION\n\t\t: point.x > blockIndentPosition + NESTING_LEVEL_INDENTATION;\n\n\treturn isNestingHorizontalGesture && point.y < rect.bottom;\n}\n\n// Block navigation is always a vertical list, so only allow dropping\n// to the above or below a block.\nconst ALLOWED_DROP_EDGES = [ 'top', 'bottom' ];\n\n/**\n * Given blocks data and the cursor position, compute the drop target.\n *\n * @param {WPListViewDropZoneBlocks} blocksData Data about the blocks in list view.\n * @param {WPPoint}                  position   The point representing the cursor position when dragging.\n * @param {boolean}                  rtl        Whether the editor is in RTL mode.\n *\n * @return {WPListViewDropZoneTarget | undefined} An object containing data about the drop target.\n */\nexport function getListViewDropTarget( blocksData, position, rtl = false ) {\n\tlet candidateEdge;\n\tlet candidateBlockData;\n\tlet candidateDistance;\n\tlet candidateRect;\n\tlet candidateBlockIndex;\n\n\tfor ( let i = 0; i < blocksData.length; i++ ) {\n\t\tconst blockData = blocksData[ i ];\n\t\tif ( blockData.isDraggedBlock ) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst rect = blockData.element.getBoundingClientRect();\n\t\tconst [ distance, edge ] = getDistanceToNearestEdge(\n\t\t\tposition,\n\t\t\trect,\n\t\t\tALLOWED_DROP_EDGES\n\t\t);\n\n\t\tconst isCursorWithinBlock = isPointContainedByRect( position, rect );\n\t\tif (\n\t\t\tcandidateDistance === undefined ||\n\t\t\tdistance < candidateDistance ||\n\t\t\tisCursorWithinBlock\n\t\t) {\n\t\t\tcandidateDistance = distance;\n\n\t\t\tconst index = blocksData.indexOf( blockData );\n\t\t\tconst previousBlockData = blocksData[ index - 1 ];\n\n\t\t\t// If dragging near the top of a block and the preceding block\n\t\t\t// is at the same level, use the preceding block as the candidate\n\t\t\t// instead, as later it makes determining a nesting drop easier.\n\t\t\tif (\n\t\t\t\tedge === 'top' &&\n\t\t\t\tpreviousBlockData &&\n\t\t\t\tpreviousBlockData.rootClientId === blockData.rootClientId &&\n\t\t\t\t! previousBlockData.isDraggedBlock\n\t\t\t) {\n\t\t\t\tcandidateBlockData = previousBlockData;\n\t\t\t\tcandidateEdge = 'bottom';\n\t\t\t\tcandidateRect =\n\t\t\t\t\tpreviousBlockData.element.getBoundingClientRect();\n\t\t\t\tcandidateBlockIndex = index - 1;\n\t\t\t} else {\n\t\t\t\tcandidateBlockData = blockData;\n\t\t\t\tcandidateEdge = edge;\n\t\t\t\tcandidateRect = rect;\n\t\t\t\tcandidateBlockIndex = index;\n\t\t\t}\n\n\t\t\t// If the mouse position is within the block, break early\n\t\t\t// as the user would intend to drop either before or after\n\t\t\t// this block.\n\t\t\t//\n\t\t\t// This solves an issue where some rows in the list view\n\t\t\t// tree overlap slightly due to sub-pixel rendering.\n\t\t\tif ( isCursorWithinBlock ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif ( ! candidateBlockData ) {\n\t\treturn;\n\t}\n\n\tconst candidateBlockParents = getCandidateBlockParents(\n\t\tcandidateBlockData,\n\t\tblocksData\n\t);\n\n\tconst isDraggingBelow = candidateEdge === 'bottom';\n\n\t// If the user is dragging towards the bottom of the block check whether\n\t// they might be trying to nest the block as a child.\n\t// If the block already has inner blocks, and is expanded, this should be treated\n\t// as nesting since the next block in the tree will be the first child.\n\t// However, if the block is collapsed, dragging beneath the block should\n\t// still be allowed, as the next visible block in the tree will be a sibling.\n\tif (\n\t\tisDraggingBelow &&\n\t\tcandidateBlockData.canInsertDraggedBlocksAsChild &&\n\t\t( ( candidateBlockData.innerBlockCount > 0 &&\n\t\t\tcandidateBlockData.isExpanded ) ||\n\t\t\tisNestingGesture(\n\t\t\t\tposition,\n\t\t\t\tcandidateRect,\n\t\t\t\tcandidateBlockParents.length,\n\t\t\t\trtl\n\t\t\t) )\n\t) {\n\t\t// If the block is expanded, insert the block as the first child.\n\t\t// Otherwise, for collapsed blocks, insert the block as the last child.\n\t\tconst newBlockIndex = candidateBlockData.isExpanded\n\t\t\t? 0\n\t\t\t: candidateBlockData.innerBlockCount || 0;\n\n\t\treturn {\n\t\t\trootClientId: candidateBlockData.clientId,\n\t\t\tblockIndex: newBlockIndex,\n\t\t\tdropPosition: 'inside',\n\t\t};\n\t}\n\n\t// If the user is dragging towards the bottom of the block check whether\n\t// they might be trying to move the block to be at a parent level.\n\tif (\n\t\tisDraggingBelow &&\n\t\tcandidateBlockData.rootClientId &&\n\t\tisUpGesture(\n\t\t\tposition,\n\t\t\tcandidateRect,\n\t\t\tcandidateBlockParents.length,\n\t\t\trtl\n\t\t)\n\t) {\n\t\tconst nextBlock = getNextNonDraggedBlock(\n\t\t\tblocksData,\n\t\t\tcandidateBlockIndex\n\t\t);\n\t\tconst currentLevel = candidateBlockData.nestingLevel;\n\t\tconst nextLevel = nextBlock ? nextBlock.nestingLevel : 1;\n\n\t\tif ( currentLevel && nextLevel ) {\n\t\t\t// Determine the desired relative level of the block to be dropped.\n\t\t\tconst desiredRelativeLevel = getDesiredRelativeParentLevel(\n\t\t\t\tposition,\n\t\t\t\tcandidateRect,\n\t\t\t\tcandidateBlockParents.length,\n\t\t\t\trtl\n\t\t\t);\n\n\t\t\tconst targetParentIndex = Math.max(\n\t\t\t\tMath.min( desiredRelativeLevel, currentLevel - nextLevel ),\n\t\t\t\t0\n\t\t\t);\n\n\t\t\tif ( candidateBlockParents[ targetParentIndex ] ) {\n\t\t\t\t// Default to the block index of the candidate block.\n\t\t\t\tlet newBlockIndex = candidateBlockData.blockIndex;\n\n\t\t\t\t// If the next block is at the same level, use that as the default\n\t\t\t\t// block index. This ensures that the block is dropped in the correct\n\t\t\t\t// position when dragging to the bottom of a block.\n\t\t\t\tif (\n\t\t\t\t\tcandidateBlockParents[ targetParentIndex ].nestingLevel ===\n\t\t\t\t\tnextBlock?.nestingLevel\n\t\t\t\t) {\n\t\t\t\t\tnewBlockIndex = nextBlock?.blockIndex;\n\t\t\t\t} else {\n\t\t\t\t\t// Otherwise, search from the current block index back\n\t\t\t\t\t// to find the last block index within the same target parent.\n\t\t\t\t\tfor ( let i = candidateBlockIndex; i >= 0; i-- ) {\n\t\t\t\t\t\tconst blockData = blocksData[ i ];\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tblockData.rootClientId ===\n\t\t\t\t\t\t\tcandidateBlockParents[ targetParentIndex ]\n\t\t\t\t\t\t\t\t.rootClientId\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tnewBlockIndex = blockData.blockIndex + 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\trootClientId:\n\t\t\t\t\t\tcandidateBlockParents[ targetParentIndex ].rootClientId,\n\t\t\t\t\tclientId: candidateBlockData.clientId,\n\t\t\t\t\tblockIndex: newBlockIndex,\n\t\t\t\t\tdropPosition: candidateEdge,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\t// If dropping as a sibling, but block cannot be inserted in\n\t// this context, return early.\n\tif ( ! candidateBlockData.canInsertDraggedBlocksAsSibling ) {\n\t\treturn;\n\t}\n\n\tconst offset = isDraggingBelow ? 1 : 0;\n\treturn {\n\t\trootClientId: candidateBlockData.rootClientId,\n\t\tclientId: candidateBlockData.clientId,\n\t\tblockIndex: candidateBlockData.blockIndex + offset,\n\t\tdropPosition: candidateEdge,\n\t};\n}\n\n/**\n * A react hook for implementing a drop zone in list view.\n *\n * @param {Object}       props                   Named parameters.\n * @param {?HTMLElement} [props.dropZoneElement] Optional element to be used as the drop zone.\n *\n * @return {WPListViewDropZoneTarget} The drop target.\n */\nexport default function useListViewDropZone( { dropZoneElement } ) {\n\tconst {\n\t\tgetBlockRootClientId,\n\t\tgetBlockIndex,\n\t\tgetBlockCount,\n\t\tgetDraggedBlockClientIds,\n\t\tcanInsertBlocks,\n\t} = useSelect( blockEditorStore );\n\tconst [ target, setTarget ] = useState();\n\tconst { rootClientId: targetRootClientId, blockIndex: targetBlockIndex } =\n\t\ttarget || {};\n\n\tconst onBlockDrop = useOnBlockDrop( targetRootClientId, targetBlockIndex );\n\n\tconst rtl = isRTL();\n\n\tconst draggedBlockClientIds = getDraggedBlockClientIds();\n\tconst throttled = useThrottle(\n\t\tuseCallback(\n\t\t\t( event, currentTarget ) => {\n\t\t\t\tconst position = { x: event.clientX, y: event.clientY };\n\t\t\t\tconst isBlockDrag = !! draggedBlockClientIds?.length;\n\n\t\t\t\tconst blockElements = Array.from(\n\t\t\t\t\tcurrentTarget.querySelectorAll( '[data-block]' )\n\t\t\t\t);\n\n\t\t\t\tconst blocksData = blockElements.map( ( blockElement ) => {\n\t\t\t\t\tconst clientId = blockElement.dataset.block;\n\t\t\t\t\tconst isExpanded = blockElement.dataset.expanded === 'true';\n\t\t\t\t\tconst isDraggedBlock =\n\t\t\t\t\t\tblockElement.classList.contains( 'is-dragging' );\n\n\t\t\t\t\t// Get nesting level from `aria-level` attribute because Firefox does not support `element.ariaLevel`.\n\t\t\t\t\tconst nestingLevel = parseInt(\n\t\t\t\t\t\tblockElement.getAttribute( 'aria-level' ),\n\t\t\t\t\t\t10\n\t\t\t\t\t);\n\t\t\t\t\tconst rootClientId = getBlockRootClientId( clientId );\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\tisExpanded,\n\t\t\t\t\t\trootClientId,\n\t\t\t\t\t\tblockIndex: getBlockIndex( clientId ),\n\t\t\t\t\t\telement: blockElement,\n\t\t\t\t\t\tnestingLevel: nestingLevel || undefined,\n\t\t\t\t\t\tisDraggedBlock: isBlockDrag ? isDraggedBlock : false,\n\t\t\t\t\t\tinnerBlockCount: getBlockCount( clientId ),\n\t\t\t\t\t\tcanInsertDraggedBlocksAsSibling: isBlockDrag\n\t\t\t\t\t\t\t? canInsertBlocks(\n\t\t\t\t\t\t\t\t\tdraggedBlockClientIds,\n\t\t\t\t\t\t\t\t\trootClientId\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t: true,\n\t\t\t\t\t\tcanInsertDraggedBlocksAsChild: isBlockDrag\n\t\t\t\t\t\t\t? canInsertBlocks( draggedBlockClientIds, clientId )\n\t\t\t\t\t\t\t: true,\n\t\t\t\t\t};\n\t\t\t\t} );\n\n\t\t\t\tconst newTarget = getListViewDropTarget(\n\t\t\t\t\tblocksData,\n\t\t\t\t\tposition,\n\t\t\t\t\trtl\n\t\t\t\t);\n\n\t\t\t\tif ( newTarget ) {\n\t\t\t\t\tsetTarget( newTarget );\n\t\t\t\t}\n\t\t\t},\n\t\t\t[\n\t\t\t\tcanInsertBlocks,\n\t\t\t\tdraggedBlockClientIds,\n\t\t\t\tgetBlockCount,\n\t\t\t\tgetBlockIndex,\n\t\t\t\tgetBlockRootClientId,\n\t\t\t\trtl,\n\t\t\t]\n\t\t),\n\t\t200\n\t);\n\n\tconst ref = useDropZone( {\n\t\tdropZoneElement,\n\t\tonDrop( event ) {\n\t\t\tif ( target ) {\n\t\t\t\tonBlockDrop( event );\n\t\t\t}\n\t\t},\n\t\tonDragLeave() {\n\t\t\tthrottled.cancel();\n\t\t\tsetTarget( null );\n\t\t},\n\t\tonDragOver( event ) {\n\t\t\t// `currentTarget` is only available while the event is being\n\t\t\t// handled, so get it now and pass it to the thottled function.\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/Event/currentTarget\n\t\t\tthrottled( event, event.currentTarget );\n\t\t},\n\t\tonDragEnd() {\n\t\t\tthrottled.cancel();\n\t\t\tsetTarget( null );\n\t\t},\n\t} );\n\n\treturn { ref, target };\n}\n"],"mappings":"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"}
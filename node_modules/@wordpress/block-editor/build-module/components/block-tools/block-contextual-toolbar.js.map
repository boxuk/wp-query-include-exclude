{"version":3,"names":["classnames","__","useLayoutEffect","useEffect","useRef","useState","hasBlockSupport","store","blocksStore","useSelect","ToolbarItem","ToolbarButton","ToolbarGroup","next","previous","useViewportMatch","NavigableToolbar","BlockToolbar","blockEditorStore","useHasAnyBlockControls","BlockContextualToolbar","focusOnMount","isFixed","props","isCollapsed","setIsCollapsed","toolbarButtonRef","isLargeViewport","blockType","blockEditingMode","hasParents","showParentSelector","selectedBlockClientId","select","getBlockName","getBlockParents","getSelectedBlockClientIds","getBlockEditingMode","getBlockType","selectedBlockClientIds","_selectedBlockClientId","parents","firstParentClientId","length","parentBlockName","parentBlockType","isLargerThanTabletViewport","isFullscreen","document","body","classList","contains","blockToolbar","querySelector","style","width","pinnedItems","leftHeader","computedToolbarStyle","window","getComputedStyle","computedPinnedItemsStyle","computedLeftHeaderStyle","marginLeft","parseFloat","pinnedItemsWidth","leftHeaderWidth","isToolbarEnabled","hasAnyBlockControls","classes","createElement","className","hideDragHandle","as","ref","icon","onClick","collapsed","current","focus","label"],"sources":["@wordpress/block-editor/src/components/block-tools/block-contextual-toolbar.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport {\n\tuseLayoutEffect,\n\tuseEffect,\n\tuseRef,\n\tuseState,\n} from '@wordpress/element';\nimport { hasBlockSupport, store as blocksStore } from '@wordpress/blocks';\nimport { useSelect } from '@wordpress/data';\nimport {\n\tToolbarItem,\n\tToolbarButton,\n\tToolbarGroup,\n} from '@wordpress/components';\nimport { next, previous } from '@wordpress/icons';\nimport { useViewportMatch } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport NavigableToolbar from '../navigable-toolbar';\nimport BlockToolbar from '../block-toolbar';\nimport { store as blockEditorStore } from '../../store';\nimport { useHasAnyBlockControls } from '../block-controls/use-has-block-controls';\n\nfunction BlockContextualToolbar( { focusOnMount, isFixed, ...props } ) {\n\t// When the toolbar is fixed it can be collapsed\n\tconst [ isCollapsed, setIsCollapsed ] = useState( false );\n\tconst toolbarButtonRef = useRef();\n\n\tconst isLargeViewport = useViewportMatch( 'medium' );\n\tconst {\n\t\tblockType,\n\t\tblockEditingMode,\n\t\thasParents,\n\t\tshowParentSelector,\n\t\tselectedBlockClientId,\n\t} = useSelect( ( select ) => {\n\t\tconst {\n\t\t\tgetBlockName,\n\t\t\tgetBlockParents,\n\t\t\tgetSelectedBlockClientIds,\n\t\t\tgetBlockEditingMode,\n\t\t} = select( blockEditorStore );\n\t\tconst { getBlockType } = select( blocksStore );\n\t\tconst selectedBlockClientIds = getSelectedBlockClientIds();\n\t\tconst _selectedBlockClientId = selectedBlockClientIds[ 0 ];\n\t\tconst parents = getBlockParents( _selectedBlockClientId );\n\t\tconst firstParentClientId = parents[ parents.length - 1 ];\n\t\tconst parentBlockName = getBlockName( firstParentClientId );\n\t\tconst parentBlockType = getBlockType( parentBlockName );\n\n\t\treturn {\n\t\t\tselectedBlockClientId: _selectedBlockClientId,\n\t\t\tblockType:\n\t\t\t\t_selectedBlockClientId &&\n\t\t\t\tgetBlockType( getBlockName( _selectedBlockClientId ) ),\n\t\t\tblockEditingMode: getBlockEditingMode( _selectedBlockClientId ),\n\t\t\thasParents: parents.length,\n\t\t\tshowParentSelector:\n\t\t\t\tparentBlockType &&\n\t\t\t\tgetBlockEditingMode( firstParentClientId ) === 'default' &&\n\t\t\t\thasBlockSupport(\n\t\t\t\t\tparentBlockType,\n\t\t\t\t\t'__experimentalParentSelector',\n\t\t\t\t\ttrue\n\t\t\t\t) &&\n\t\t\t\tselectedBlockClientIds.length <= 1 &&\n\t\t\t\tgetBlockEditingMode( _selectedBlockClientId ) === 'default',\n\t\t};\n\t}, [] );\n\n\tuseEffect( () => {\n\t\tsetIsCollapsed( false );\n\t}, [ selectedBlockClientId ] );\n\n\tconst isLargerThanTabletViewport = useViewportMatch( 'large', '>=' );\n\tconst isFullscreen =\n\t\tdocument.body.classList.contains( 'is-fullscreen-mode' );\n\n\t/**\n\t * The following code is a workaround to fix the width of the toolbar\n\t * it should be removed when the toolbar will be rendered inline\n\t * FIXME: remove this layout effect when the toolbar is no longer\n\t * \t\t\t\tabsolutely positioned\n\t */\n\tuseLayoutEffect( () => {\n\t\t// don't do anything if not fixed toolbar\n\t\tif ( ! isFixed ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst blockToolbar = document.querySelector(\n\t\t\t'.block-editor-block-contextual-toolbar'\n\t\t);\n\n\t\tif ( ! blockToolbar ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! blockType ) {\n\t\t\tblockToolbar.style.width = 'initial';\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! isLargerThanTabletViewport ) {\n\t\t\t// set the width of the toolbar to auto\n\t\t\tblockToolbar.style = {};\n\t\t\treturn;\n\t\t}\n\n\t\tif ( isCollapsed ) {\n\t\t\t// set the width of the toolbar to auto\n\t\t\tblockToolbar.style.width = 'auto';\n\t\t\treturn;\n\t\t}\n\n\t\t// get the width of the pinned items in the post editor or widget editor\n\t\tconst pinnedItems = document.querySelector(\n\t\t\t'.edit-post-header__settings, .edit-widgets-header__actions'\n\t\t);\n\t\t// get the width of the left header in the site editor\n\t\tconst leftHeader = document.querySelector(\n\t\t\t'.edit-site-header-edit-mode__end'\n\t\t);\n\n\t\tconst computedToolbarStyle = window.getComputedStyle( blockToolbar );\n\t\tconst computedPinnedItemsStyle = pinnedItems\n\t\t\t? window.getComputedStyle( pinnedItems )\n\t\t\t: false;\n\t\tconst computedLeftHeaderStyle = leftHeader\n\t\t\t? window.getComputedStyle( leftHeader )\n\t\t\t: false;\n\n\t\tconst marginLeft = parseFloat( computedToolbarStyle.marginLeft );\n\t\tconst pinnedItemsWidth = computedPinnedItemsStyle\n\t\t\t? parseFloat( computedPinnedItemsStyle.width )\n\t\t\t: 0;\n\t\tconst leftHeaderWidth = computedLeftHeaderStyle\n\t\t\t? parseFloat( computedLeftHeaderStyle.width )\n\t\t\t: 0;\n\n\t\t// set the new witdth of the toolbar\n\t\tblockToolbar.style.width = `calc(100% - ${\n\t\t\tleftHeaderWidth +\n\t\t\tpinnedItemsWidth +\n\t\t\tmarginLeft +\n\t\t\t( pinnedItems || leftHeader ? 2 : 0 ) + // Prevents button focus border from being cut off\n\t\t\t( isFullscreen ? 0 : 160 ) // the width of the admin sidebar expanded\n\t\t}px)`;\n\t}, [\n\t\tisFixed,\n\t\tisLargerThanTabletViewport,\n\t\tisCollapsed,\n\t\tisFullscreen,\n\t\tblockType,\n\t] );\n\n\tconst isToolbarEnabled =\n\t\t! blockType ||\n\t\thasBlockSupport( blockType, '__experimentalToolbar', true );\n\tconst hasAnyBlockControls = useHasAnyBlockControls();\n\tif (\n\t\t! isToolbarEnabled ||\n\t\t( blockEditingMode !== 'default' && ! hasAnyBlockControls )\n\t) {\n\t\treturn null;\n\t}\n\n\t// Shifts the toolbar to make room for the parent block selector.\n\tconst classes = classnames( 'block-editor-block-contextual-toolbar', {\n\t\t'has-parent': hasParents && showParentSelector,\n\t\t'is-fixed': isFixed,\n\t\t'is-collapsed': isCollapsed,\n\t} );\n\n\treturn (\n\t\t<NavigableToolbar\n\t\t\tfocusOnMount={ focusOnMount }\n\t\t\tclassName={ classes }\n\t\t\t/* translators: accessibility text for the block toolbar */\n\t\t\taria-label={ __( 'Block tools' ) }\n\t\t\t{ ...props }\n\t\t>\n\t\t\t{ ! isCollapsed && <BlockToolbar hideDragHandle={ isFixed } /> }\n\t\t\t{ isFixed && isLargeViewport && blockType && (\n\t\t\t\t<ToolbarGroup\n\t\t\t\t\tclassName={\n\t\t\t\t\t\tisCollapsed\n\t\t\t\t\t\t\t? 'block-editor-block-toolbar__group-expand-fixed-toolbar'\n\t\t\t\t\t\t\t: 'block-editor-block-toolbar__group-collapse-fixed-toolbar'\n\t\t\t\t\t}\n\t\t\t\t>\n\t\t\t\t\t<ToolbarItem\n\t\t\t\t\t\tas={ ToolbarButton }\n\t\t\t\t\t\tref={ toolbarButtonRef }\n\t\t\t\t\t\ticon={ isCollapsed ? next : previous }\n\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\tsetIsCollapsed( ( collapsed ) => ! collapsed );\n\t\t\t\t\t\t\ttoolbarButtonRef.current.focus();\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tlabel={\n\t\t\t\t\t\t\tisCollapsed\n\t\t\t\t\t\t\t\t? __( 'Show block tools' )\n\t\t\t\t\t\t\t\t: __( 'Hide block tools' )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t) }\n\t\t</NavigableToolbar>\n\t);\n}\n\nexport default BlockContextualToolbar;\n"],"mappings":"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"}
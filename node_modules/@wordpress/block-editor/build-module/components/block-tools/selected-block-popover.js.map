{"version":3,"names":["classnames","useRef","useEffect","isUnmodifiedDefaultBlock","useDispatch","useSelect","useShortcut","BlockSelectionButton","BlockContextualToolbar","store","blockEditorStore","BlockPopover","useBlockToolbarPopoverProps","Inserter","useShouldContextualToolbarShow","selector","select","__unstableGetEditorMode","hasMultiSelection","isTyping","getLastMultiSelectedBlockClientId","editorMode","lastClientId","SelectedBlockPopover","clientId","rootClientId","isEmptyDefaultBlock","capturingClientId","__unstablePopoverSlot","__unstableContentRef","isInsertionPointVisible","isBlockInsertionPointVisible","getBlockInsertionPoint","getBlockOrder","insertionPoint","order","index","isToolbarForced","shouldShowContextualToolbar","canFocusHiddenToolbar","stopTyping","showEmptyBlockSideInserter","shouldShowBreadcrumb","current","isDisabled","initialToolbarItemIndexRef","undefined","popoverProps","contentElement","createElement","__unstableCoverTarget","bottomClientId","className","resize","shift","position","__experimentalIsQuick","focusOnMount","__experimentalInitialIndex","__experimentalOnIndexChange","key","wrapperSelector","getSelectedBlockClientId","getFirstMultiSelectedBlockClientId","getBlockRootClientId","getBlock","getBlockParents","__experimentalGetBlockListSettingsForBlocks","name","attributes","blockParentsClientIds","parentBlockListSettings","find","parentClientId","__experimentalCaptureToolbars","WrappedBlockPopover","selected"],"sources":["@wordpress/block-editor/src/components/block-tools/selected-block-popover.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useRef, useEffect } from '@wordpress/element';\nimport { isUnmodifiedDefaultBlock } from '@wordpress/blocks';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useShortcut } from '@wordpress/keyboard-shortcuts';\n\n/**\n * Internal dependencies\n */\nimport BlockSelectionButton from './block-selection-button';\nimport BlockContextualToolbar from './block-contextual-toolbar';\nimport { store as blockEditorStore } from '../../store';\nimport BlockPopover from '../block-popover';\nimport useBlockToolbarPopoverProps from './use-block-toolbar-popover-props';\nimport Inserter from '../inserter';\nimport { useShouldContextualToolbarShow } from '../../utils/use-should-contextual-toolbar-show';\n\nfunction selector( select ) {\n\tconst {\n\t\t__unstableGetEditorMode,\n\t\thasMultiSelection,\n\t\tisTyping,\n\t\tgetLastMultiSelectedBlockClientId,\n\t} = select( blockEditorStore );\n\n\treturn {\n\t\teditorMode: __unstableGetEditorMode(),\n\t\thasMultiSelection: hasMultiSelection(),\n\t\tisTyping: isTyping(),\n\t\tlastClientId: hasMultiSelection()\n\t\t\t? getLastMultiSelectedBlockClientId()\n\t\t\t: null,\n\t};\n}\n\nfunction SelectedBlockPopover( {\n\tclientId,\n\trootClientId,\n\tisEmptyDefaultBlock,\n\tcapturingClientId,\n\t__unstablePopoverSlot,\n\t__unstableContentRef,\n} ) {\n\tconst { editorMode, hasMultiSelection, isTyping, lastClientId } = useSelect(\n\t\tselector,\n\t\t[]\n\t);\n\n\tconst isInsertionPointVisible = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tisBlockInsertionPointVisible,\n\t\t\t\tgetBlockInsertionPoint,\n\t\t\t\tgetBlockOrder,\n\t\t\t} = select( blockEditorStore );\n\n\t\t\tif ( ! isBlockInsertionPointVisible() ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst insertionPoint = getBlockInsertionPoint();\n\t\t\tconst order = getBlockOrder( insertionPoint.rootClientId );\n\t\t\treturn order[ insertionPoint.index ] === clientId;\n\t\t},\n\t\t[ clientId ]\n\t);\n\tconst isToolbarForced = useRef( false );\n\tconst { shouldShowContextualToolbar, canFocusHiddenToolbar } =\n\t\tuseShouldContextualToolbarShow();\n\n\tconst { stopTyping } = useDispatch( blockEditorStore );\n\n\tconst showEmptyBlockSideInserter =\n\t\t! isTyping && editorMode === 'edit' && isEmptyDefaultBlock;\n\tconst shouldShowBreadcrumb =\n\t\t! hasMultiSelection &&\n\t\t( editorMode === 'navigation' || editorMode === 'zoom-out' );\n\n\tuseShortcut(\n\t\t'core/block-editor/focus-toolbar',\n\t\t() => {\n\t\t\tisToolbarForced.current = true;\n\t\t\tstopTyping( true );\n\t\t},\n\t\t{\n\t\t\tisDisabled: ! canFocusHiddenToolbar,\n\t\t}\n\t);\n\n\tuseEffect( () => {\n\t\tisToolbarForced.current = false;\n\t} );\n\n\t// Stores the active toolbar item index so the block toolbar can return focus\n\t// to it when re-mounting.\n\tconst initialToolbarItemIndexRef = useRef();\n\n\tuseEffect( () => {\n\t\t// Resets the index whenever the active block changes so this is not\n\t\t// persisted. See https://github.com/WordPress/gutenberg/pull/25760#issuecomment-717906169\n\t\tinitialToolbarItemIndexRef.current = undefined;\n\t}, [ clientId ] );\n\n\tconst popoverProps = useBlockToolbarPopoverProps( {\n\t\tcontentElement: __unstableContentRef?.current,\n\t\tclientId,\n\t} );\n\n\tif ( showEmptyBlockSideInserter ) {\n\t\treturn (\n\t\t\t<BlockPopover\n\t\t\t\tclientId={ capturingClientId || clientId }\n\t\t\t\t__unstableCoverTarget\n\t\t\t\tbottomClientId={ lastClientId }\n\t\t\t\tclassName={ classnames(\n\t\t\t\t\t'block-editor-block-list__block-side-inserter-popover',\n\t\t\t\t\t{\n\t\t\t\t\t\t'is-insertion-point-visible': isInsertionPointVisible,\n\t\t\t\t\t}\n\t\t\t\t) }\n\t\t\t\t__unstablePopoverSlot={ __unstablePopoverSlot }\n\t\t\t\t__unstableContentRef={ __unstableContentRef }\n\t\t\t\tresize={ false }\n\t\t\t\tshift={ false }\n\t\t\t\t{ ...popoverProps }\n\t\t\t>\n\t\t\t\t<div className=\"block-editor-block-list__empty-block-inserter\">\n\t\t\t\t\t<Inserter\n\t\t\t\t\t\tposition=\"bottom right\"\n\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\t__experimentalIsQuick\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</BlockPopover>\n\t\t);\n\t}\n\n\tif ( shouldShowBreadcrumb || shouldShowContextualToolbar ) {\n\t\treturn (\n\t\t\t<BlockPopover\n\t\t\t\tclientId={ capturingClientId || clientId }\n\t\t\t\tbottomClientId={ lastClientId }\n\t\t\t\tclassName={ classnames(\n\t\t\t\t\t'block-editor-block-list__block-popover',\n\t\t\t\t\t{\n\t\t\t\t\t\t'is-insertion-point-visible': isInsertionPointVisible,\n\t\t\t\t\t}\n\t\t\t\t) }\n\t\t\t\t__unstablePopoverSlot={ __unstablePopoverSlot }\n\t\t\t\t__unstableContentRef={ __unstableContentRef }\n\t\t\t\tresize={ false }\n\t\t\t\t{ ...popoverProps }\n\t\t\t>\n\t\t\t\t{ shouldShowContextualToolbar && (\n\t\t\t\t\t<BlockContextualToolbar\n\t\t\t\t\t\t// If the toolbar is being shown because of being forced\n\t\t\t\t\t\t// it should focus the toolbar right after the mount.\n\t\t\t\t\t\tfocusOnMount={ isToolbarForced.current }\n\t\t\t\t\t\t__experimentalInitialIndex={\n\t\t\t\t\t\t\tinitialToolbarItemIndexRef.current\n\t\t\t\t\t\t}\n\t\t\t\t\t\t__experimentalOnIndexChange={ ( index ) => {\n\t\t\t\t\t\t\tinitialToolbarItemIndexRef.current = index;\n\t\t\t\t\t\t} }\n\t\t\t\t\t\t// Resets the index whenever the active block changes so\n\t\t\t\t\t\t// this is not persisted. See https://github.com/WordPress/gutenberg/pull/25760#issuecomment-717906169\n\t\t\t\t\t\tkey={ clientId }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t{ shouldShowBreadcrumb && (\n\t\t\t\t\t<BlockSelectionButton\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</BlockPopover>\n\t\t);\n\t}\n\n\treturn null;\n}\n\nfunction wrapperSelector( select ) {\n\tconst {\n\t\tgetSelectedBlockClientId,\n\t\tgetFirstMultiSelectedBlockClientId,\n\t\tgetBlockRootClientId,\n\t\tgetBlock,\n\t\tgetBlockParents,\n\t\t__experimentalGetBlockListSettingsForBlocks,\n\t} = select( blockEditorStore );\n\n\tconst clientId =\n\t\tgetSelectedBlockClientId() || getFirstMultiSelectedBlockClientId();\n\n\tif ( ! clientId ) {\n\t\treturn;\n\t}\n\n\tconst { name, attributes = {} } = getBlock( clientId ) || {};\n\tconst blockParentsClientIds = getBlockParents( clientId );\n\n\t// Get Block List Settings for all ancestors of the current Block clientId.\n\tconst parentBlockListSettings = __experimentalGetBlockListSettingsForBlocks(\n\t\tblockParentsClientIds\n\t);\n\n\t// Get the clientId of the topmost parent with the capture toolbars setting.\n\tconst capturingClientId = blockParentsClientIds.find(\n\t\t( parentClientId ) =>\n\t\t\tparentBlockListSettings[ parentClientId ]\n\t\t\t\t?.__experimentalCaptureToolbars\n\t);\n\n\treturn {\n\t\tclientId,\n\t\trootClientId: getBlockRootClientId( clientId ),\n\t\tname,\n\t\tisEmptyDefaultBlock:\n\t\t\tname && isUnmodifiedDefaultBlock( { name, attributes } ),\n\t\tcapturingClientId,\n\t};\n}\n\nexport default function WrappedBlockPopover( {\n\t__unstablePopoverSlot,\n\t__unstableContentRef,\n} ) {\n\tconst selected = useSelect( wrapperSelector, [] );\n\n\tif ( ! selected ) {\n\t\treturn null;\n\t}\n\n\tconst {\n\t\tclientId,\n\t\trootClientId,\n\t\tname,\n\t\tisEmptyDefaultBlock,\n\t\tcapturingClientId,\n\t} = selected;\n\n\tif ( ! name ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<SelectedBlockPopover\n\t\t\tclientId={ clientId }\n\t\t\trootClientId={ rootClientId }\n\t\t\tisEmptyDefaultBlock={ isEmptyDefaultBlock }\n\t\t\tcapturingClientId={ capturingClientId }\n\t\t\t__unstablePopoverSlot={ __unstablePopoverSlot }\n\t\t\t__unstableContentRef={ __unstableContentRef }\n\t\t/>\n\t);\n}\n"],"mappings":"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"}
{"version":3,"names":["useSpring","useState","useLayoutEffect","useReducer","useMemo","useRef","useReducedMotion","getScrollContainer","counterReducer","state","getAbsolutePosition","element","top","offsetTop","left","offsetLeft","useMovingAnimation","isSelected","adjustScrolling","enableAnimation","triggerAnimationOnChange","ref","prefersReducedMotion","triggeredAnimation","triggerAnimation","finishedAnimation","endAnimation","transform","setTransform","x","y","previous","current","preserveScrollPosition","scrollContainer","prevRect","getBoundingClientRect","blockRect","diff","scrollTop","style","undefined","destination","Math","round","onChange","value","finishedMoving","transformOrigin","zIndex","from","to","reset","config","mass","tension","friction","immediate"],"sources":["@wordpress/block-editor/src/components/use-moving-animation/index.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { useSpring } from '@react-spring/web';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tuseState,\n\tuseLayoutEffect,\n\tuseReducer,\n\tuseMemo,\n\tuseRef,\n} from '@wordpress/element';\nimport { useReducedMotion } from '@wordpress/compose';\nimport { getScrollContainer } from '@wordpress/dom';\n\n/**\n * Simple reducer used to increment a counter.\n *\n * @param {number} state Previous counter value.\n * @return {number} New state value.\n */\nconst counterReducer = ( state ) => state + 1;\n\nconst getAbsolutePosition = ( element ) => {\n\treturn {\n\t\ttop: element.offsetTop,\n\t\tleft: element.offsetLeft,\n\t};\n};\n\n/**\n * Hook used to compute the styles required to move a div into a new position.\n *\n * The way this animation works is the following:\n *  - It first renders the element as if there was no animation.\n *  - It takes a snapshot of the position of the block to use it\n *    as a destination point for the animation.\n *  - It restores the element to the previous position using a CSS transform\n *  - It uses the \"resetAnimation\" flag to reset the animation\n *    from the beginning in order to animate to the new destination point.\n *\n * @param {Object}  $1                          Options\n * @param {boolean} $1.isSelected               Whether it's the current block or not.\n * @param {boolean} $1.adjustScrolling          Adjust the scroll position to the current block.\n * @param {boolean} $1.enableAnimation          Enable/Disable animation.\n * @param {*}       $1.triggerAnimationOnChange Variable used to trigger the animation if it changes.\n */\nfunction useMovingAnimation( {\n\tisSelected,\n\tadjustScrolling,\n\tenableAnimation,\n\ttriggerAnimationOnChange,\n} ) {\n\tconst ref = useRef();\n\tconst prefersReducedMotion = useReducedMotion() || ! enableAnimation;\n\tconst [ triggeredAnimation, triggerAnimation ] = useReducer(\n\t\tcounterReducer,\n\t\t0\n\t);\n\tconst [ finishedAnimation, endAnimation ] = useReducer( counterReducer, 0 );\n\tconst [ transform, setTransform ] = useState( { x: 0, y: 0 } );\n\tconst previous = useMemo(\n\t\t() => ( ref.current ? getAbsolutePosition( ref.current ) : null ),\n\t\t[ triggerAnimationOnChange ]\n\t);\n\n\t// Calculate the previous position of the block relative to the viewport and\n\t// return a function to maintain that position by scrolling.\n\tconst preserveScrollPosition = useMemo( () => {\n\t\tif ( ! adjustScrolling || ! ref.current ) {\n\t\t\treturn () => {};\n\t\t}\n\n\t\tconst scrollContainer = getScrollContainer( ref.current );\n\n\t\tif ( ! scrollContainer ) {\n\t\t\treturn () => {};\n\t\t}\n\n\t\tconst prevRect = ref.current.getBoundingClientRect();\n\t\treturn () => {\n\t\t\tconst blockRect = ref.current.getBoundingClientRect();\n\t\t\tconst diff = blockRect.top - prevRect.top;\n\n\t\t\tif ( diff ) {\n\t\t\t\tscrollContainer.scrollTop += diff;\n\t\t\t}\n\t\t};\n\t}, [ triggerAnimationOnChange, adjustScrolling ] );\n\n\tuseLayoutEffect( () => {\n\t\tif ( triggeredAnimation ) {\n\t\t\tendAnimation();\n\t\t}\n\t}, [ triggeredAnimation ] );\n\tuseLayoutEffect( () => {\n\t\tif ( ! previous ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( prefersReducedMotion ) {\n\t\t\t// If the animation is disabled and the scroll needs to be adjusted,\n\t\t\t// just move directly to the final scroll position.\n\t\t\tpreserveScrollPosition();\n\n\t\t\treturn;\n\t\t}\n\n\t\tref.current.style.transform = undefined;\n\t\tconst destination = getAbsolutePosition( ref.current );\n\n\t\ttriggerAnimation();\n\t\tsetTransform( {\n\t\t\tx: Math.round( previous.left - destination.left ),\n\t\t\ty: Math.round( previous.top - destination.top ),\n\t\t} );\n\t}, [ triggerAnimationOnChange ] );\n\n\tfunction onChange( { value } ) {\n\t\tif ( ! ref.current ) {\n\t\t\treturn;\n\t\t}\n\t\tlet { x, y } = value;\n\t\tx = Math.round( x );\n\t\ty = Math.round( y );\n\t\tconst finishedMoving = x === 0 && y === 0;\n\t\tref.current.style.transformOrigin = 'center center';\n\t\tref.current.style.transform = finishedMoving\n\t\t\t? undefined\n\t\t\t: `translate3d(${ x }px,${ y }px,0)`;\n\t\tref.current.style.zIndex = isSelected ? '1' : '';\n\n\t\tpreserveScrollPosition();\n\t}\n\n\tuseSpring( {\n\t\tfrom: {\n\t\t\tx: transform.x,\n\t\t\ty: transform.y,\n\t\t},\n\t\tto: {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t},\n\t\treset: triggeredAnimation !== finishedAnimation,\n\t\tconfig: { mass: 5, tension: 2000, friction: 200 },\n\t\timmediate: prefersReducedMotion,\n\t\tonChange,\n\t} );\n\n\treturn ref;\n}\n\nexport default useMovingAnimation;\n"],"mappings":"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"}
{"version":3,"names":["_classnames","_interopRequireDefault","require","_data","_blocks","_defaultBlockAppender","_buttonBlockAppender","_store","DefaultAppender","rootClientId","canInsertDefaultBlock","useSelect","select","blockEditorStore","canInsertBlockType","getDefaultBlockName","_element","createElement","default","className","useAppender","CustomAppender","isVisible","getTemplateLock","getSelectedBlockClientId","__unstableGetEditorMode","getBlockEditingMode","selectedBlockClientId","isParentSelected","BlockListAppender","renderAppender","tagName","TagName","appender","isDragOver","getBlockInsertionPoint","isBlockInsertionPointVisible","getBlockCount","insertionPoint","tabIndex","classnames","contentEditable","_default","exports"],"sources":["@wordpress/block-editor/src/components/block-list-appender/index.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { getDefaultBlockName } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport DefaultBlockAppender from '../default-block-appender';\nimport ButtonBlockAppender from '../button-block-appender';\nimport { store as blockEditorStore } from '../../store';\n\nfunction DefaultAppender( { rootClientId } ) {\n\tconst canInsertDefaultBlock = useSelect( ( select ) =>\n\t\tselect( blockEditorStore ).canInsertBlockType(\n\t\t\tgetDefaultBlockName(),\n\t\t\trootClientId\n\t\t)\n\t);\n\n\tif ( canInsertDefaultBlock ) {\n\t\t// Render the default block appender if the context supports use\n\t\t// of the default appender.\n\t\treturn <DefaultBlockAppender rootClientId={ rootClientId } />;\n\t}\n\n\t// Fallback in case the default block can't be inserted.\n\treturn (\n\t\t<ButtonBlockAppender\n\t\t\trootClientId={ rootClientId }\n\t\t\tclassName=\"block-list-appender__toggle\"\n\t\t/>\n\t);\n}\n\nfunction useAppender( rootClientId, CustomAppender ) {\n\tconst isVisible = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetTemplateLock,\n\t\t\t\tgetSelectedBlockClientId,\n\t\t\t\t__unstableGetEditorMode,\n\t\t\t\tgetBlockEditingMode,\n\t\t\t} = select( blockEditorStore );\n\n\t\t\tif ( CustomAppender === false ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif ( ! CustomAppender ) {\n\t\t\t\tconst selectedBlockClientId = getSelectedBlockClientId();\n\t\t\t\tconst isParentSelected =\n\t\t\t\t\trootClientId === selectedBlockClientId ||\n\t\t\t\t\t( ! rootClientId && ! selectedBlockClientId );\n\t\t\t\tif ( ! isParentSelected ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tgetTemplateLock( rootClientId ) ||\n\t\t\t\tgetBlockEditingMode( rootClientId ) === 'disabled' ||\n\t\t\t\t__unstableGetEditorMode() === 'zoom-out'\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\t[ rootClientId, CustomAppender ]\n\t);\n\n\tif ( ! isVisible ) {\n\t\treturn null;\n\t}\n\n\treturn CustomAppender ? (\n\t\t<CustomAppender />\n\t) : (\n\t\t<DefaultAppender rootClientId={ rootClientId } />\n\t);\n}\n\nfunction BlockListAppender( {\n\trootClientId,\n\trenderAppender,\n\tclassName,\n\ttagName: TagName = 'div',\n} ) {\n\tconst appender = useAppender( rootClientId, renderAppender );\n\tconst isDragOver = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetBlockInsertionPoint,\n\t\t\t\tisBlockInsertionPointVisible,\n\t\t\t\tgetBlockCount,\n\t\t\t} = select( blockEditorStore );\n\t\t\tconst insertionPoint = getBlockInsertionPoint();\n\t\t\t// Ideally we should also check for `isDragging` but currently it\n\t\t\t// requires a lot more setup. We can revisit this once we refactor\n\t\t\t// the DnD utility hooks.\n\t\t\treturn (\n\t\t\t\tisBlockInsertionPointVisible() &&\n\t\t\t\trootClientId === insertionPoint?.rootClientId &&\n\t\t\t\tgetBlockCount( rootClientId ) === 0\n\t\t\t);\n\t\t},\n\t\t[ rootClientId ]\n\t);\n\n\tif ( ! appender ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<TagName\n\t\t\t// A `tabIndex` is used on the wrapping `div` element in order to\n\t\t\t// force a focus event to occur when an appender `button` element\n\t\t\t// is clicked. In some browsers (Firefox, Safari), button clicks do\n\t\t\t// not emit a focus event, which could cause this event to propagate\n\t\t\t// unexpectedly. The `tabIndex` ensures that the interaction is\n\t\t\t// captured as a focus, without also adding an extra tab stop.\n\t\t\t//\n\t\t\t// See: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n\t\t\ttabIndex={ -1 }\n\t\t\tclassName={ classnames( 'block-list-appender wp-block', className, {\n\t\t\t\t'is-drag-over': isDragOver,\n\t\t\t} ) }\n\t\t\t// Needed in case the whole editor is content editable (for multi\n\t\t\t// selection). It fixes an edge case where ArrowDown and ArrowRight\n\t\t\t// should collapse the selection to the end of that selection and\n\t\t\t// not into the appender.\n\t\t\tcontentEditable={ false }\n\t\t\t// The appender exists to let you add the first Paragraph before\n\t\t\t// any is inserted. To that end, this appender should visually be\n\t\t\t// presented as a block. That means theme CSS should style it as if\n\t\t\t// it were an empty paragraph block. That means a `wp-block` class to\n\t\t\t// ensure the width is correct, and a [data-block] attribute to ensure\n\t\t\t// the correct margin is applied, especially for classic themes which\n\t\t\t// have commonly targeted that attribute for margins.\n\t\t\tdata-block\n\t\t>\n\t\t\t{ appender }\n\t\t</TagName>\n\t);\n}\n\nexport default BlockListAppender;\n"],"mappings":"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"}
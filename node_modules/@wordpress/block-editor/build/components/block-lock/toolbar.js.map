{"version":3,"names":["_element","require","_i18n","_components","_dom","_icons","_modal","_interopRequireDefault","_useBlockLock","BlockLockToolbar","clientId","wrapperRef","canEdit","canMove","canRemove","canLock","useBlockLock","isModalOpen","toggleModal","useReducer","isActive","lockButtonRef","useRef","isFirstRender","shouldHideBlockLockUI","useEffect","current","focus","focusable","find","sequential","element","tagName","createElement","Fragment","ToolbarGroup","className","ToolbarButton","ref","icon","lock","label","__","onClick","default","onClose"],"sources":["@wordpress/block-editor/src/components/block-lock/toolbar.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { ToolbarButton, ToolbarGroup } from '@wordpress/components';\nimport { focus } from '@wordpress/dom';\nimport { useReducer, useRef, useEffect } from '@wordpress/element';\nimport { lock } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport BlockLockModal from './modal';\nimport useBlockLock from './use-block-lock';\n\nexport default function BlockLockToolbar( { clientId, wrapperRef } ) {\n\tconst { canEdit, canMove, canRemove, canLock } = useBlockLock( clientId );\n\n\tconst [ isModalOpen, toggleModal ] = useReducer(\n\t\t( isActive ) => ! isActive,\n\t\tfalse\n\t);\n\n\tconst lockButtonRef = useRef( null );\n\tconst isFirstRender = useRef( true );\n\n\tconst shouldHideBlockLockUI =\n\t\t! canLock || ( canEdit && canMove && canRemove );\n\n\t// Restore focus manually on the first focusable element in the toolbar\n\t// when the block lock modal is closed and the block is not locked anymore.\n\t// See https://github.com/WordPress/gutenberg/issues/51447\n\tuseEffect( () => {\n\t\tif ( isFirstRender.current ) {\n\t\t\tisFirstRender.current = false;\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! isModalOpen && shouldHideBlockLockUI ) {\n\t\t\tfocus.focusable\n\t\t\t\t.find( wrapperRef.current, {\n\t\t\t\t\tsequential: false,\n\t\t\t\t} )\n\t\t\t\t.find(\n\t\t\t\t\t( element ) =>\n\t\t\t\t\t\telement.tagName === 'BUTTON' &&\n\t\t\t\t\t\telement !== lockButtonRef.current\n\t\t\t\t)\n\t\t\t\t?.focus();\n\t\t}\n\t\t// wrapperRef is a reference object and should be stable\n\t}, [ isModalOpen, shouldHideBlockLockUI, wrapperRef ] );\n\n\tif ( shouldHideBlockLockUI ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<ToolbarGroup className=\"block-editor-block-lock-toolbar\">\n\t\t\t\t<ToolbarButton\n\t\t\t\t\tref={ lockButtonRef }\n\t\t\t\t\ticon={ lock }\n\t\t\t\t\tlabel={ __( 'Unlock' ) }\n\t\t\t\t\tonClick={ toggleModal }\n\t\t\t\t\taria-expanded={ isModalOpen }\n\t\t\t\t\taria-haspopup=\"dialog\"\n\t\t\t\t/>\n\t\t\t</ToolbarGroup>\n\t\t\t{ isModalOpen && (\n\t\t\t\t<BlockLockModal clientId={ clientId } onClose={ toggleModal } />\n\t\t\t) }\n\t\t</>\n\t);\n}\n"],"mappings":";;;;;;;AAMA,IAAAA,QAAA,GAAAC,OAAA;AAHA,IAAAC,KAAA,GAAAD,OAAA;AACA,IAAAE,WAAA,GAAAF,OAAA;AACA,IAAAG,IAAA,GAAAH,OAAA;AAEA,IAAAI,MAAA,GAAAJ,OAAA;AAKA,IAAAK,MAAA,GAAAC,sBAAA,CAAAN,OAAA;AACA,IAAAO,aAAA,GAAAD,sBAAA,CAAAN,OAAA;AAbA;AACA;AACA;;AAOA;AACA;AACA;;AAIe,SAASQ,gBAAgBA,CAAE;EAAEC,QAAQ;EAAEC;AAAW,CAAC,EAAG;EACpE,MAAM;IAAEC,OAAO;IAAEC,OAAO;IAAEC,SAAS;IAAEC;EAAQ,CAAC,GAAG,IAAAC,qBAAY,EAAEN,QAAS,CAAC;EAEzE,MAAM,CAAEO,WAAW,EAAEC,WAAW,CAAE,GAAG,IAAAC,mBAAU,EAC5CC,QAAQ,IAAM,CAAEA,QAAQ,EAC1B,KACD,CAAC;EAED,MAAMC,aAAa,GAAG,IAAAC,eAAM,EAAE,IAAK,CAAC;EACpC,MAAMC,aAAa,GAAG,IAAAD,eAAM,EAAE,IAAK,CAAC;EAEpC,MAAME,qBAAqB,GAC1B,CAAET,OAAO,IAAMH,OAAO,IAAIC,OAAO,IAAIC,SAAW;;EAEjD;EACA;EACA;EACA,IAAAW,kBAAS,EAAE,MAAM;IAChB,IAAKF,aAAa,CAACG,OAAO,EAAG;MAC5BH,aAAa,CAACG,OAAO,GAAG,KAAK;MAC7B;IACD;IAEA,IAAK,CAAET,WAAW,IAAIO,qBAAqB,EAAG;MAC7CG,UAAK,CAACC,SAAS,CACbC,IAAI,CAAElB,UAAU,CAACe,OAAO,EAAE;QAC1BI,UAAU,EAAE;MACb,CAAE,CAAC,CACFD,IAAI,CACFE,OAAO,IACRA,OAAO,CAACC,OAAO,KAAK,QAAQ,IAC5BD,OAAO,KAAKV,aAAa,CAACK,OAC5B,CAAC,EACCC,KAAK,CAAC,CAAC;IACX;IACA;EACD,CAAC,EAAE,CAAEV,WAAW,EAAEO,qBAAqB,EAAEb,UAAU,CAAG,CAAC;EAEvD,IAAKa,qBAAqB,EAAG;IAC5B,OAAO,IAAI;EACZ;EAEA,OACC,IAAAxB,QAAA,CAAAiC,aAAA,EAAAjC,QAAA,CAAAkC,QAAA,QACC,IAAAlC,QAAA,CAAAiC,aAAA,EAAC9B,WAAA,CAAAgC,YAAY;IAACC,SAAS,EAAC;EAAiC,GACxD,IAAApC,QAAA,CAAAiC,aAAA,EAAC9B,WAAA,CAAAkC,aAAa;IACbC,GAAG,EAAGjB,aAAe;IACrBkB,IAAI,EAAGC,WAAM;IACbC,KAAK,EAAG,IAAAC,QAAE,EAAE,QAAS,CAAG;IACxBC,OAAO,EAAGzB,WAAa;IACvB,iBAAgBD,WAAa;IAC7B,iBAAc;EAAQ,CACtB,CACY,CAAC,EACbA,WAAW,IACZ,IAAAjB,QAAA,CAAAiC,aAAA,EAAC3B,MAAA,CAAAsC,OAAc;IAAClC,QAAQ,EAAGA,QAAU;IAACmC,OAAO,EAAG3B;EAAa,CAAE,CAE/D,CAAC;AAEL"}
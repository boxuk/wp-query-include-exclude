{"version":3,"names":["_web","require","_element","_compose","_dom","counterReducer","state","getAbsolutePosition","element","top","offsetTop","left","offsetLeft","useMovingAnimation","isSelected","adjustScrolling","enableAnimation","triggerAnimationOnChange","ref","useRef","prefersReducedMotion","useReducedMotion","triggeredAnimation","triggerAnimation","useReducer","finishedAnimation","endAnimation","transform","setTransform","useState","x","y","previous","useMemo","current","preserveScrollPosition","scrollContainer","getScrollContainer","prevRect","getBoundingClientRect","blockRect","diff","scrollTop","useLayoutEffect","style","undefined","destination","Math","round","onChange","value","finishedMoving","transformOrigin","zIndex","useSpring","from","to","reset","config","mass","tension","friction","immediate","_default","exports","default"],"sources":["@wordpress/block-editor/src/components/use-moving-animation/index.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { useSpring } from '@react-spring/web';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tuseState,\n\tuseLayoutEffect,\n\tuseReducer,\n\tuseMemo,\n\tuseRef,\n} from '@wordpress/element';\nimport { useReducedMotion } from '@wordpress/compose';\nimport { getScrollContainer } from '@wordpress/dom';\n\n/**\n * Simple reducer used to increment a counter.\n *\n * @param {number} state Previous counter value.\n * @return {number} New state value.\n */\nconst counterReducer = ( state ) => state + 1;\n\nconst getAbsolutePosition = ( element ) => {\n\treturn {\n\t\ttop: element.offsetTop,\n\t\tleft: element.offsetLeft,\n\t};\n};\n\n/**\n * Hook used to compute the styles required to move a div into a new position.\n *\n * The way this animation works is the following:\n *  - It first renders the element as if there was no animation.\n *  - It takes a snapshot of the position of the block to use it\n *    as a destination point for the animation.\n *  - It restores the element to the previous position using a CSS transform\n *  - It uses the \"resetAnimation\" flag to reset the animation\n *    from the beginning in order to animate to the new destination point.\n *\n * @param {Object}  $1                          Options\n * @param {boolean} $1.isSelected               Whether it's the current block or not.\n * @param {boolean} $1.adjustScrolling          Adjust the scroll position to the current block.\n * @param {boolean} $1.enableAnimation          Enable/Disable animation.\n * @param {*}       $1.triggerAnimationOnChange Variable used to trigger the animation if it changes.\n */\nfunction useMovingAnimation( {\n\tisSelected,\n\tadjustScrolling,\n\tenableAnimation,\n\ttriggerAnimationOnChange,\n} ) {\n\tconst ref = useRef();\n\tconst prefersReducedMotion = useReducedMotion() || ! enableAnimation;\n\tconst [ triggeredAnimation, triggerAnimation ] = useReducer(\n\t\tcounterReducer,\n\t\t0\n\t);\n\tconst [ finishedAnimation, endAnimation ] = useReducer( counterReducer, 0 );\n\tconst [ transform, setTransform ] = useState( { x: 0, y: 0 } );\n\tconst previous = useMemo(\n\t\t() => ( ref.current ? getAbsolutePosition( ref.current ) : null ),\n\t\t[ triggerAnimationOnChange ]\n\t);\n\n\t// Calculate the previous position of the block relative to the viewport and\n\t// return a function to maintain that position by scrolling.\n\tconst preserveScrollPosition = useMemo( () => {\n\t\tif ( ! adjustScrolling || ! ref.current ) {\n\t\t\treturn () => {};\n\t\t}\n\n\t\tconst scrollContainer = getScrollContainer( ref.current );\n\n\t\tif ( ! scrollContainer ) {\n\t\t\treturn () => {};\n\t\t}\n\n\t\tconst prevRect = ref.current.getBoundingClientRect();\n\t\treturn () => {\n\t\t\tconst blockRect = ref.current.getBoundingClientRect();\n\t\t\tconst diff = blockRect.top - prevRect.top;\n\n\t\t\tif ( diff ) {\n\t\t\t\tscrollContainer.scrollTop += diff;\n\t\t\t}\n\t\t};\n\t}, [ triggerAnimationOnChange, adjustScrolling ] );\n\n\tuseLayoutEffect( () => {\n\t\tif ( triggeredAnimation ) {\n\t\t\tendAnimation();\n\t\t}\n\t}, [ triggeredAnimation ] );\n\tuseLayoutEffect( () => {\n\t\tif ( ! previous ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( prefersReducedMotion ) {\n\t\t\t// If the animation is disabled and the scroll needs to be adjusted,\n\t\t\t// just move directly to the final scroll position.\n\t\t\tpreserveScrollPosition();\n\n\t\t\treturn;\n\t\t}\n\n\t\tref.current.style.transform = undefined;\n\t\tconst destination = getAbsolutePosition( ref.current );\n\n\t\ttriggerAnimation();\n\t\tsetTransform( {\n\t\t\tx: Math.round( previous.left - destination.left ),\n\t\t\ty: Math.round( previous.top - destination.top ),\n\t\t} );\n\t}, [ triggerAnimationOnChange ] );\n\n\tfunction onChange( { value } ) {\n\t\tif ( ! ref.current ) {\n\t\t\treturn;\n\t\t}\n\t\tlet { x, y } = value;\n\t\tx = Math.round( x );\n\t\ty = Math.round( y );\n\t\tconst finishedMoving = x === 0 && y === 0;\n\t\tref.current.style.transformOrigin = 'center center';\n\t\tref.current.style.transform = finishedMoving\n\t\t\t? undefined\n\t\t\t: `translate3d(${ x }px,${ y }px,0)`;\n\t\tref.current.style.zIndex = isSelected ? '1' : '';\n\n\t\tpreserveScrollPosition();\n\t}\n\n\tuseSpring( {\n\t\tfrom: {\n\t\t\tx: transform.x,\n\t\t\ty: transform.y,\n\t\t},\n\t\tto: {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t},\n\t\treset: triggeredAnimation !== finishedAnimation,\n\t\tconfig: { mass: 5, tension: 2000, friction: 200 },\n\t\timmediate: prefersReducedMotion,\n\t\tonChange,\n\t} );\n\n\treturn ref;\n}\n\nexport default useMovingAnimation;\n"],"mappings":"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"}
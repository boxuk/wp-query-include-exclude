{"version":3,"names":["_element","require","_components","_compose","_data","_hooks","_i18n","_store","_components2","StopEditingAsBlocksOnOutsideSelect","clientId","stopEditingAsBlock","isBlockOrDescendantSelected","useSelect","select","isBlockSelected","hasSelectedInnerBlock","blockEditorStore","useEffect","withBlockControls","createHigherOrderComponent","BlockEdit","props","getBlockListSettings","getSettings","focusModeToRevert","useRef","templateLock","isLockedByParent","isEditingAsBlocks","__unstableGetContentLockingParent","getTemplateLock","__unstableGetTemporarilyEditingAsBlocks","updateSettings","updateBlockListSettings","__unstableSetTemporarilyEditingAsBlocks","useDispatch","isContentLocked","__unstableMarkNextChangeAsNotPersistent","updateBlockAttributes","useCallback","focusMode","current","createElement","key","showStopEditingAsBlocks","showStartEditingAsBlocks","isSelected","Fragment","BlockControls","group","ToolbarButton","onClick","__","BlockSettingsMenuControls","onClose","MenuItem","undefined","exports","addFilter"],"sources":["@wordpress/block-editor/src/hooks/content-lock-ui.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { ToolbarButton, MenuItem } from '@wordpress/components';\nimport { createHigherOrderComponent } from '@wordpress/compose';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { addFilter } from '@wordpress/hooks';\nimport { __ } from '@wordpress/i18n';\nimport { useEffect, useRef, useCallback } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../store';\nimport { BlockControls, BlockSettingsMenuControls } from '../components';\n\nfunction StopEditingAsBlocksOnOutsideSelect( {\n\tclientId,\n\tstopEditingAsBlock,\n} ) {\n\tconst isBlockOrDescendantSelected = useSelect(\n\t\t( select ) => {\n\t\t\tconst { isBlockSelected, hasSelectedInnerBlock } =\n\t\t\t\tselect( blockEditorStore );\n\t\t\treturn (\n\t\t\t\tisBlockSelected( clientId ) ||\n\t\t\t\thasSelectedInnerBlock( clientId, true )\n\t\t\t);\n\t\t},\n\t\t[ clientId ]\n\t);\n\tuseEffect( () => {\n\t\tif ( ! isBlockOrDescendantSelected ) {\n\t\t\tstopEditingAsBlock();\n\t\t}\n\t}, [ isBlockOrDescendantSelected, stopEditingAsBlock ] );\n\treturn null;\n}\n\nexport const withBlockControls = createHigherOrderComponent(\n\t( BlockEdit ) => ( props ) => {\n\t\tconst { getBlockListSettings, getSettings } =\n\t\t\tuseSelect( blockEditorStore );\n\t\tconst focusModeToRevert = useRef();\n\t\tconst { templateLock, isLockedByParent, isEditingAsBlocks } = useSelect(\n\t\t\t( select ) => {\n\t\t\t\tconst {\n\t\t\t\t\t__unstableGetContentLockingParent,\n\t\t\t\t\tgetTemplateLock,\n\t\t\t\t\t__unstableGetTemporarilyEditingAsBlocks,\n\t\t\t\t} = select( blockEditorStore );\n\t\t\t\treturn {\n\t\t\t\t\ttemplateLock: getTemplateLock( props.clientId ),\n\t\t\t\t\tisLockedByParent: !! __unstableGetContentLockingParent(\n\t\t\t\t\t\tprops.clientId\n\t\t\t\t\t),\n\t\t\t\t\tisEditingAsBlocks:\n\t\t\t\t\t\t__unstableGetTemporarilyEditingAsBlocks() ===\n\t\t\t\t\t\tprops.clientId,\n\t\t\t\t};\n\t\t\t},\n\t\t\t[ props.clientId ]\n\t\t);\n\n\t\tconst {\n\t\t\tupdateSettings,\n\t\t\tupdateBlockListSettings,\n\t\t\t__unstableSetTemporarilyEditingAsBlocks,\n\t\t} = useDispatch( blockEditorStore );\n\t\tconst isContentLocked =\n\t\t\t! isLockedByParent && templateLock === 'contentOnly';\n\t\tconst {\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t\tupdateBlockAttributes,\n\t\t} = useDispatch( blockEditorStore );\n\n\t\tconst stopEditingAsBlock = useCallback( () => {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\tupdateBlockAttributes( props.clientId, {\n\t\t\t\ttemplateLock: 'contentOnly',\n\t\t\t} );\n\t\t\tupdateBlockListSettings( props.clientId, {\n\t\t\t\t...getBlockListSettings( props.clientId ),\n\t\t\t\ttemplateLock: 'contentOnly',\n\t\t\t} );\n\t\t\tupdateSettings( { focusMode: focusModeToRevert.current } );\n\t\t\t__unstableSetTemporarilyEditingAsBlocks();\n\t\t}, [\n\t\t\tprops.clientId,\n\t\t\tupdateSettings,\n\t\t\tupdateBlockListSettings,\n\t\t\tgetBlockListSettings,\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t\tupdateBlockAttributes,\n\t\t\t__unstableSetTemporarilyEditingAsBlocks,\n\t\t] );\n\n\t\tif ( ! isContentLocked && ! isEditingAsBlocks ) {\n\t\t\treturn <BlockEdit key=\"edit\" { ...props } />;\n\t\t}\n\n\t\tconst showStopEditingAsBlocks = isEditingAsBlocks && ! isContentLocked;\n\t\tconst showStartEditingAsBlocks =\n\t\t\t! isEditingAsBlocks && isContentLocked && props.isSelected;\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{ showStopEditingAsBlocks && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<StopEditingAsBlocksOnOutsideSelect\n\t\t\t\t\t\t\tclientId={ props.clientId }\n\t\t\t\t\t\t\tstopEditingAsBlock={ stopEditingAsBlock }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<BlockControls group=\"other\">\n\t\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\tstopEditingAsBlock();\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ __( 'Done' ) }\n\t\t\t\t\t\t\t</ToolbarButton>\n\t\t\t\t\t\t</BlockControls>\n\t\t\t\t\t</>\n\t\t\t\t) }\n\t\t\t\t{ showStartEditingAsBlocks && (\n\t\t\t\t\t<BlockSettingsMenuControls>\n\t\t\t\t\t\t{ ( { onClose } ) => (\n\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\t\t\t\t\t\t\tupdateBlockAttributes( props.clientId, {\n\t\t\t\t\t\t\t\t\t\ttemplateLock: undefined,\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t\tupdateBlockListSettings( props.clientId, {\n\t\t\t\t\t\t\t\t\t\t...getBlockListSettings(\n\t\t\t\t\t\t\t\t\t\t\tprops.clientId\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\ttemplateLock: false,\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t\tfocusModeToRevert.current =\n\t\t\t\t\t\t\t\t\t\tgetSettings().focusMode;\n\t\t\t\t\t\t\t\t\tupdateSettings( { focusMode: true } );\n\t\t\t\t\t\t\t\t\t__unstableSetTemporarilyEditingAsBlocks(\n\t\t\t\t\t\t\t\t\t\tprops.clientId\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tonClose();\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ __( 'Modify' ) }\n\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</BlockSettingsMenuControls>\n\t\t\t\t) }\n\t\t\t\t<BlockEdit key=\"edit\" { ...props } />\n\t\t\t</>\n\t\t);\n\t},\n\t'withToolbarControls'\n);\n\naddFilter(\n\t'editor.BlockEdit',\n\t'core/content-lock-ui/with-block-controls',\n\twithBlockControls\n);\n"],"mappings":"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"}
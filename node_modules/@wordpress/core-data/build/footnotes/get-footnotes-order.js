"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getFootnotesOrder;
var _getRichTextValuesCached = _interopRequireDefault(require("./get-rich-text-values-cached"));
/**
 * Internal dependencies
 */

const cache = new WeakMap();
function getBlockFootnotesOrder(block) {
  if (!cache.has(block)) {
    const content = (0, _getRichTextValuesCached.default)(block).join('');
    const newOrder = [];

    // https://github.com/WordPress/gutenberg/pull/43204 lands. We can then
    // get the order directly from the rich text values.
    if (content.indexOf('data-fn') !== -1) {
      const regex = /data-fn="([^"]+)"/g;
      let match;
      while ((match = regex.exec(content)) !== null) {
        newOrder.push(match[1]);
      }
    }
    cache.set(block, newOrder);
  }
  return cache.get(block);
}
function getFootnotesOrder(blocks) {
  return blocks.flatMap(getBlockFootnotesOrder);
}
//# sourceMappingURL=get-footnotes-order.js.map